<div class="tnt-restaurants">
    <div class="tnt-restaurants__filter">
        <!--
          filterForm: Reactive form controlling the restaurant filters.
          Controls:
            - name: text input used to match against restaurant title
            - location: select options from locationOptions() (Location enum)
            - isFavorite: checkbox to show only favorites when checked
          Changes reset the current page and update the filtered grid and totals.
        -->
        <form class="tnt-form" [formGroup]="filterForm">
            <div class="tnt-form__row">
                <label class="tnt-form__label" for="name">Name</label>
                <input class="tnt-input" id="name" type="text" formControlName="name" />
            </div>
            <div class="tnt-form__row">
                <label class="tnt-form__label" for="location">Location</label>
                <select class="tnt-select" id="location" formControlName="location">
                    <option value="">All</option>
                    @for (loc of locationOptions(); track loc) {
                        <option [value]="loc">{{ loc }}</option>
                    }
                </select>
            </div>
            <div class="tnt-form__row">
                <label class="tnt-form__label" for="isFavorite">Favorite</label>
                <input class="tnt-toggle" id="isFavorite" type="checkbox" formControlName="isFavorite" />
            </div>
            <div class="tnt-form__row tnt-form__row--actions">
                <tnt-button [primary]="true" [blockSm]="true" (click)="clearSearch()">Clear search</tnt-button>
            </div>
        </form>
    </div>

    @let restaurants = (restaurants$ | async) ?? [];

    @defer {
        <!-- Loading: show skeleton grid -->
        @if (isLoading()) {
            <div class="tnt-grid tnt-grid--col-3">
                @for (i of [0, 1, 2, 3, 4, 5, 6, 7, 8]; track i) {
                    <div class="tnt-grid__col">
                        <tnt-skeleton-card></tnt-skeleton-card>
                    </div>
                }
            </div>
        } @else {
            <!-- Not loading: show restaurants grid and pagination -->
            @if (restaurants.length > 0) {
                <div class="tnt-grid tnt-grid--col-3">
                    @for (restaurant of restaurants; track restaurant.id; let i = $index) {
                        <div class="tnt-grid__col">
                            <tnt-card
                                [imageUrl]="restaurant.imageUrl"
                                [type]="restaurant.type"
                                [title]="restaurant.title"
                                [description]="restaurant.description"
                                [priority]="i === 0"
                                [(isFavorite)]="restaurant.isFavorite"
                                (isFavoriteChange)="onFavoriteChange(restaurant.id, $event)"
                            >
                                <div tnt-card-meta class="tnt-restaurants__meta">
                                    {{ restaurant.location }} · ⭐ {{ restaurant.rating }} · ${{ restaurant.priceUsd }}
                                    @if (isRestaurant(restaurant)) {
                                        · {{ restaurant.reviewCount }} reviews
                                    }
                                </div>
                            </tnt-card>
                        </div>
                    }
                </div>
            } @else {
                <tnt-empty-card> No restaurants found. </tnt-empty-card>
            }

            <div class="tnt-restaurants__pagination">
                <tnt-pagination [total]="totalRestaurants()" [pageSize]="pageSize" [(page)]="page"></tnt-pagination>
            </div>
        }
    } @placeholder {
        <div class="tnt-grid tnt-grid--col-3">
            @for (i of [0, 1, 2, 3, 4, 5, 6, 7, 8]; track i) {
                <div class="tnt-grid__col">
                    <tnt-skeleton-card></tnt-skeleton-card>
                </div>
            }
        </div>
    }
</div>
